# SPDX-FileCopyrightText: 2025 Jonas Fierlings <fnoegip@gmail.com>
#
# SPDX-License-Identifier: 0BSD
#
#:schema https://raw.githubusercontent.com/jj-vcs/jj/main/cli/src/config-schema.json

[user]
# Set with `jj config set --repo user.email "fnoegip@gmail.com"
# Not set to default value so that projects always use the correct E-Mail by forcing me to choose
# manually.
# email = "fnoegip@gmail.com"
name = "Jonas Fierlings"

[core]
{{#if (eq dotter.os "windows") }}
fsmonitor = "watchman"
{{/if}}

[ui]
default-command = ["log", "-n", "10"]
# TODO(PigeonF): Figure out something cross platform.
diff-editor = ":builtin"
# merge-editor = "vscodium"
paginate = "never"

[git]
sign-on-push = true
push-bookmark-prefix = "push-"
private-commits = "description(glob:\"private:*\")"

[signing]
backend = "ssh"
key = "ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAID+2wAQrbFDe18oFY2Mv6qsUcYWJZPAcsV+Xr4ZHzncL"

[aliases]
d = ["diff"]
ds = ["diff", "--stat"]
g = ["git"]
l = ["log", "-T", "builtin_log_compact"]
ll = ["log", "-T", "builtin_log_detailed"]
ls = ["log", "-r", "mutable()::@"]
s = ["status"]
sq = ["squash"]
sqk = ["squash", "--keep-empty"]
sign = [
  "describe",
  "--no-edit",
  "--reset-author",
  "--config",
  "signing.sign-all=true",
  "--config",
  "signing.backend=ssh",
]

[templates]
log = "builtin_log_comfortable"

draft_commit_description = '''
concat(
  description,
  "\n",
  surround(
    "JJ: HEAD detached at ", "\n",
    concat(commit_id, "\n"),
  ),
  surround(
    "JJ: This commit contains the following changes:\n", "\n",
    indent("JJ:     ", diff.summary()),
  ),
  surround(
    "JJ: ------------------------ >8 ------------------------\n",
    "",
    indent("JJ: ", diff.git()),
  )
)
'''

[template-aliases]
starship = '''
separate(" ",
  change_id.shortest(6),
  bookmarks.map(|x| if(
    x.name().substr(0, 20).starts_with(x.name()),
    x.name().substr(0, 20),
    x.name().substr(0, 19) ++ "…")
  ).join(" "),
  if(
    description.first_line().substr(0, 24).starts_with(description.first_line()),
    description.first_line().substr(0, 24),
    description.first_line().substr(0, 23) ++ "…"
  ),
  if(conflict, "conflict"),
  if(divergent, "divergent"),
  if(hidden, "hidden"),
)
'''
